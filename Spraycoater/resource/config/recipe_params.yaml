version: 1

recipe_params:

  globals:
    speed_mm_s:
      type: number
      min: 10
      max: 2000
      step: 10
      unit: "mm/s"
      default: 200
      plc: false

    stand_off_mm:
      type: number
      min: 0.1
      max: 200
      step: 0.1
      unit: "mm"
      default: 50.0
      plc: false

    sample_step_mm:
      type: number
      min: 0.05
      max: 50
      step: 0.05
      unit: "mm"
      default: 1.0
      plc: false

    max_points:
      type: number
      min: 100
      max: 2000
      step: 100
      default: 1000
      plc: false

    pre_dispense_s:
      type: number
      min: 0.0
      max: 10.0
      step: 0.1
      unit: "s"
      default: 0.2
      plc: false

    post_dispense_s:
      type: number
      min: 0.0
      max: 10.0
      step: 0.1
      unit: "s"
      default: 0.1
      plc: false

    n2_pressure_bar:
      type: number
      min: 0.0
      max: 6.0
      step: 0.05
      unit: "bar"
      default: 1.5
      plc: true

    us_power_percent:
      type: number
      min: 0.0
      max: 100
      step: 1.0
      unit: "%"
      default: 60.0
      plc: true

    syringe_flow_ml_min:
      type: number
      min: 0.0
      max: 50.0
      step: 0.1
      unit: "ml/min"
      default: 5.0
      plc: true

    nozzle_on_delay_s:
      type: number
      min: 0.0
      max: 5.0
      step: 0.05
      unit: "s"
      default: 0.3
      plc: true

    syringe_on_delay_s:
      type: number
      min: 0.0
      max: 5.0
      step: 0.05
      unit: "s"
      default: 0.5
      plc: true

    nozzle_off_delay_s:
      type: number
      min: 0.0
      max: 5.0
      step: 0.05
      unit: "s"
      default: 0.2
      plc: true

    syringe_off_delay_s:
      type: number
      min: 0.0
      max: 5.0
      step: 0.05
      unit: "s"
      default: 0.2
      plc: true

    dryrun:
      type: boolean
      default: false
      plc: true

    syringe_only:
      type: boolean
      default: false
      plc: true


  # ============================================================
  # Path Types
  # ============================================================

  # --- Meander (Plane) ---
  # CLEAN:
  # - angle_deg entfernt
  # - optional corner_radius_mm bewusst NICHT als Param (Code macht "immer rund" intern)
  # - rename: edge_extend_mm -> extend_x_mm, margin_mm -> extend_y_mm
  path.meander.plane:
    area.shape:        { type: enum, values: ["circle","rect"], default: "circle" }
    area.center_xy_mm: { type: vec2, min: [-1000,-1000], max: [1000,1000], step: [0.1,0.1], unit: "mm", default: [0,0] }

    area.radius_mm:    { type: number, min: 1.0, max: 2000, step: 0.1, unit: "mm", default: 50.0, visible_if: {"area.shape":"circle"} }
    area.size_mm:      { type: vec2,   min: [1.0,1.0], max: [5000,5000], step: [0.1,0.1], unit: "mm", default: [100.0,100.0], visible_if: {"area.shape":"rect"} }

    pitch_mm:          { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 5.0 }

    start:             { type: enum, values: ["auto","minx_miny","minx_maxy","maxx_miny","maxx_maxy"], default: "auto" }

    # Post-Processing (trim)
    extend_x_mm:       { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0, description: "Verlängerung links/rechts (längere Zeilen)" }
    extend_y_mm:       { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0, description: "Extra Bereich oben/unten (mehr Zeilen)" }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }


  # --- Spiral (Plane) ---
  path.spiral.plane:
    center_xy_mm: { type: vec2,   min: [-1000,-1000], max: [1000,1000], step: [0.1,0.1], unit: "mm", default: [0,0] }
    r_outer_mm:   { type: number, min: 0.1, max: 2000, step: 0.1, unit: "mm", default: 49.0 }
    r_inner_mm:   { type: number, min: 0.0, max: 1000, step: 0.1, unit: "mm", default: 1.0 }
    pitch_mm:     { type: number, min: 0.1, max: 200,  step: 0.1, unit: "mm", default: 4.0 }
    direction:    { type: enum,   values: ["cw","ccw"], default: "ccw" }


    # Post-Processing (trim)
    radial_offset_mm: { type: number, min: -100.0, max: 100.0, step: 0.1, unit: "mm", default: 0.0, description: "Vergrößert (+) oder verkleinert (-) den Radius der Spirale" }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }


  # --- Spiral (Cylinder / Helix) ---
  path.spiral.cylinder:
    radius_mm:        { type: number, min: 1.0, max: 2000, step: 0.1, unit: "mm", default: 50.0 }
    height_mm:        { type: number, min: 1.0, max: 2000, step: 1.0, unit: "mm", default: 100.0 }
    pitch_mm:         { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 10.0 }

    start_from:       { type: enum, values: ["top","bottom"], default: "top" }
    direction:        { type: enum, values: ["cw","ccw"],     default: "ccw" }

    # Post-Processing (trim)
    top_extend_mm:    { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0, description: "Verlängert die Spirale über Z-Top hinaus" }
    bottom_extend_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0, description: "Verlängert die Spirale über Z-Bottom hinaus" }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }


  # --- Polyhelix (Pyramid) ---
  path.polyhelix.pyramid:
    base_polygon_sides:    { type: enum, values: [3,4,5,6], default: 4 }
    base_edge_len_mm:      { type: number, min: 5, max: 5000, step: 0.1, unit: "mm", default: 100.0 }
    height_mm:             { type: number, min: 5, max: 5000, step: 0.1, unit: "mm", default: 60.0 }
    pitch_mm:              { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 6.0 }
    dz_mm:                 { type: number, min: 0.05, max: 50, step: 0.05, unit: "mm", default: 1.0 }
    start_phase_deg:       { type: number, min: 0, max: 360, step: 1, unit: "deg", default: 0 }
    stand_off_mm:          { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 25.0 }
    corner_roll_radius_mm: { type: number, min: 0, max: 50, step: 0.1, unit: "mm", default: 8.0 }
    cap_top_mm:            { type: number, min: 0, max: 200, step: 0.1, unit: "mm", default: 8.0 }

    # Post-Processing (trim)
    start_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    end_offset_mm:   { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }


  # --- Polyhelix (Cube) ---
  path.polyhelix.cube:
    edge_len_mm:           { type: number, min: 5, max: 5000, step: 0.1, unit: "mm", default: 100.0 }
    height_mm:             { type: number, min: 5, max: 5000, step: 0.1, unit: "mm", default: 100.0 }
    pitch_mm:              { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 6.0 }
    dz_mm:                 { type: number, min: 0.05, max: 50, step: 0.05, unit: "mm", default: 1.0 }
    start_phase_deg:       { type: number, min: 0, max: 360, step: 1, unit: "deg", default: 0 }
    stand_off_mm:          { type: number, min: 0.1, max: 200, step: 0.1, unit: "mm", default: 25.0 }
    corner_roll_radius_mm: { type: number, min: 0, max: 50, step: 0.1, unit: "mm", default: 8.0 }

    # Post-Processing (trim)
    start_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    end_offset_mm:   { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }


  # --- Perimeter-Follow (Plane) ---
  # CLEAN:
  # - spray_angle_deg entfernt
  # - flow_scale_min/max entfernt
  path.perimeter_follow.plane:
    area.shape:        { type: enum, values: ["circle","rect"], default: "circle" }
    area.center_xy_mm: { type: vec2, min: [-1000,-1000], max: [1000,1000], step: [0.1,0.1], unit: "mm", default: [0,0] }
    area.radius_mm:    { type: number, min: 1.0, max: 2000, step: 0.1, unit: "mm", default: 50.0, visible_if: {"area.shape":"circle"} }
    area.size_mm:      { type: vec2,   min: [1.0,1.0], max: [5000,5000], step: [0.1,0.1], unit: "mm", default: [100.0,100.0], visible_if: {"area.shape":"rect"} }

    loops:           { type: number, min: 1, max: 10, step: 1, default: 2 }
    offset_start_mm: { type: number, min: -20, max: 20, step: 0.1, unit: "mm", default: 1.0 }
    offset_step_mm:  { type: number, min: 0, max: 10, step: 0.1, unit: "mm", default: 1.0 }
    corner_blend_mm: { type: number, min: 0, max: 20, step: 0.1, unit: "mm", default: 5.0 }

    # Post-Processing (trim)
    radial_offset_mm: { type: number, min: -100.0, max: 100.0, step: 0.1, unit: "mm", default: 0.0, description: "Vergrößert (+) oder verkleinert (-) den Radius der Spirale" }

    # Air Moves
    predispense_offset_mm: { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
    retreat_offset_mm:     { type: number, min: 0.0, max: 200, step: 0.1, unit: "mm", default: 0.0 }
