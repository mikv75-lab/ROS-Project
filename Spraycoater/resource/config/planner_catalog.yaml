version: 1

planner_catalog:

  # -------------------------------------------------------------------
  # Param-Profiles (Zentrale Definition der Hardware-Limits)
  # -------------------------------------------------------------------
  param_profiles:

    # Diese Keys entsprechen exakt den .get() Aufrufen im moveit_py_node.py
    motion_common:
      planning_time:                   { type: number,  min: 0.1, max: 60.0, step: 0.1,  default: 5.0 } 
      planning_attempts:               { type: integer, min: 1,   max: 100,  step: 1,    default: 5 }
      
      # WICHTIG: 0.1 verhindert Dynamik-Fehler (ERROR:EX) bei Pilz LIN
      max_velocity_scaling_factor:     { type: number,  min: 0.01, max: 1.0,  step: 0.01, default: 0.1 }
      max_acceleration_scaling_factor: { type: number,  min: 0.01, max: 1.0,  step: 0.01, default: 0.1 }
      
      # Blending: 0.01 (10mm) erlaubt flüssige Kurven ohne Stop-and-Go
      blend_radius:                    { type: number,  min: 0.0, max: 0.5, step: 0.001, default: 0.01 } 

    # Kartesische Parameter für die Spirale (plan_pose_array)
    cartesian_common:
      cartesian_max_step:              { type: number,  min: 0.0001, max: 0.05, step: 0.001, default: 0.002 }
      cartesian_jump_threshold:        { type: number,  min: 0.0,    max: 10.0, step: 0.1,   default: 0.0 }

    # Parameter für das Post-Processing (TOTG Retiming)
    post_common:
      max_velocity_scaling_factor:     { type: number, min: 0.01, max: 1.0, step: 0.01, default: 0.1 }
      max_acceleration_scaling_factor: { type: number, min: 0.01, max: 1.0, step: 0.01, default: 0.1 }

  # -------------------------------------------------------------------
  # Roles (Verfügbarkeit im UI nach Kategorie)
  # -------------------------------------------------------------------
  roles:
    validate_move:
      - "PTP"
      - "LIN"
      - "RRTConnectkConfigDefault"

    validate_path:
      - "LIN"
      - "PTP"
      - "CIRC"
      - "RRTstarkConfigDefault"
      - "RRTConnectkConfigDefault"

    optimize:
      - "TimeOptimalTrajectoryGeneration"

  # -------------------------------------------------------------------
  # Pipelines (Detail-Konfiguration)
  # -------------------------------------------------------------------
  pipelines:

    ompl:
      RRTConnectkConfigDefault:
        description: "OMPL Standard (PTP)"
        params_ref: ["motion_common", "cartesian_common"]

      RRTstarkConfigDefault:
        description: "OMPL RRT* (Optimierend)"
        params_ref: ["motion_common", "cartesian_common"]
        params_override:
          planning_time: { default: 10.0 }

    # Pilz Industrial Motion Planner
    pilz_industrial_motion_planner:
      PTP:
        description: "Pilz PTP (Gelenk-Anfahrt)"
        params_ref: ["motion_common"]
        params_override:
          planning_time: { default: 1.0 } 

      LIN:
        description: "Pilz LIN (Präzise Linie)"
        params_ref: ["motion_common"]
        params_override:
          planning_time: { default: 1.0 }
          blend_radius: { default: 0.01 } 

      CIRC:
        description: "Pilz CIRC (Kreisbahn)"
        params_ref: ["motion_common"]
        params_override:
          planning_time: { default: 1.0 }

    post:
      TimeOptimalTrajectoryGeneration:
        description: "TOTG (Zeit-Optimierung)"
        params_ref: ["post_common"]

  # -------------------------------------------------------------------
  # Path-Types (Vorauswahl für Pfad-Algorithmen)
  # -------------------------------------------------------------------
  path_types:
    path.spiral.plane:
      validate_move: ["PTP"]
      validate_path: ["LIN", "RRTstarkConfigDefault"]

    path.meander.plane:
      validate_move: ["PTP"]
      validate_path: ["LIN", "RRTConnectkConfigDefault"]