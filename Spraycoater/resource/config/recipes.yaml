version: 1
units: "mm"   # Pfad-/Geometrieparameter in mm (STLs ebenfalls)

spraycoater:
  defaults:
    speed_mm_s: 200.0
    stand_off_mm: 10.0
    spray_angle_deg: 0        # Top = 0° (Helix überschreibt)
    pre_dispense_s: 0.2
    post_dispense_s: 0.1
    flow_ml_min: 5.0
    overlap_pct: 50
    enable_purge: false

# --------- UI/Validierungs-Spezifikationen für die Rezepte ----------
recipe_params:

  globals:
    speed_mm_s:       { type: number, min: 10,   max: 2000, step: 10,  unit: "mm/s",  default: 200 }
    stand_off_mm:     { type: number, min: 0.1,  max: 200,  step: 0.1, unit: "mm",    default: 10 }
    spray_angle_deg:  { type: number, min: 0,    max: 90,   step: 1,   unit: "deg",   default: 0 }
    pre_dispense_s:   { type: number, min: 0.0,  max: 10.0, step: 0.1, unit: "s",     default: 0.2 }
    post_dispense_s:  { type: number, min: 0.0,  max: 10.0, step: 0.1, unit: "s",     default: 0.1 }
    flow_ml_min:      { type: number, min: 0.0,  max: 100.0,step: 0.1, unit: "ml/min",default: 5.0 }
    overlap_pct:      { type: number, min: 0,    max: 100,  step: 1,   unit: "%",     default: 50 }
    enable_purge:     { type: boolean, default: false }

  path.spiral.plane:
    center_xy_mm:     { type: vec2,   min: [-1000,-1000], max: [1000,1000], step: [0.1,0.1], unit: "mm", default: [0,0] }
    r_start_mm:       { type: number, min: 0.0,  max: 1000, step: 0.1, unit: "mm", default: 10.0 }
    r_end_mm:         { type: number, min: 0.1,  max: 2000, step: 0.1, unit: "mm", default: 70.0 }
    pitch_mm:         { type: number, min: 0.1,  max: 200,  step: 0.1, unit: "mm", default: 5.0 }
    z_mm:             { type: number, min: 0.0,  max: 500,  step: 0.1, unit: "mm", default: 10.0 }

  path.spiral.cylinder:
    pitch_mm:         { type: number, min: 0.1, max: 200,  step: 0.1, unit: "mm", default: 10.0 }
    outside_mm:       { type: number, min: 0.0, max: 100,  step: 0.1, unit: "mm", default: 1.0 }
    margin_top_mm:    { type: number, min: 0.0, max: 200,  step: 0.1, unit: "mm", default: 0.0 }
    margin_bottom_mm: { type: number, min: 0.0, max: 200,  step: 0.1, unit: "mm", default: 0.0 }
    direction:        { type: enum,   values: ["cw","ccw"], default: "ccw" }
    # Hinweis: spray_angle_deg aus globals (für Helix erforderlich; UI sichtbar lassen)

  path.meander.plane:
    area.shape:        { type: enum, values: ["circle","rect"], default: "circle" }
    area.center_xy_mm: { type: vec2, min: [-1000,-1000], max: [1000,1000], step: [0.1,0.1], unit: "mm", default: [0,0] }
    area.radius_mm:    { type: number, min: 1.0, max: 2000, step: 0.1, unit: "mm", default: 70.0,
                         visible_if: {"area.shape":"circle"} }
    area.size_mm:      { type: vec2,   min: [1.0,1.0], max: [5000,5000], step: [0.1,0.1], unit: "mm", default: [120.0,120.0],
                         visible_if: {"area.shape":"rect"} }
    pitch_mm:          { type: number, min: 0.1, max: 200,  step: 0.1, unit: "mm", default: 5.0 }
    angle_deg:         { type: number, min: 0,   max: 180,  step: 1,   unit: "deg", default: 0 }
    edge_extend_mm:    { type: number, min: 0.0, max: 200,  step: 0.1, unit: "mm", default: 0.0 }
    margin_mm:         { type: number, min: 0.0, max: 200,  step: 0.1, unit: "mm", default: 0.0 }
    boustrophedon:     { type: boolean, default: true }
    start:             { type: enum, values: ["auto","minx_miny","minx_maxy","maxx_miny","maxx_maxy"], default: "auto" }

  path.explicit:
    read_only: { type: boolean, default: true }
# --------------------------------------------------------------------------

active_recipe: "wafer_top_meander"

recipes:

  # MEANDER – Kreis (Wafer)
  - id: "wafer_top_meander"
    description: "Top-Meander (kreisförmig) auf Wafern"
    tool: "spray_nozzle_01"                  # kommt aus tools.yaml
    substrates: ["wafer_d100_h2", "wafer_d150_h2", "wafer_d200_h2"]
    mount: "flat_240x240"                    # kommt aus substrate_mounts.yaml
    side: "top"
    parameters: {}                           # Top ⇒ Spraywinkel 0°
    path:
      type: "meander"
      mode: "plane"
      area: { shape: circle, center_xy_mm: [0.0, 0.0], radius_mm: 70.0 }
      pitch_mm: 5.0
      angle_deg: 0.0
      edge_extend_mm: 0.0
      margin_mm: 0.0
      boustrophedon: true
      start: "auto"

  # SPIRAL – plane (Top)
  - id: "wafer_top_spiral"
    description: "Top-Spirale auf Wafern"
    tool: "spray_nozzle_01"
    substrates: ["wafer_d100_h2", "wafer_d150_h2", "wafer_d200_h2"]
    mount: "flat_240x240"
    side: "top"
    parameters: {}
    path:
      type: "spiral"
      mode: "plane"
      center_xy_mm: [0.0, 0.0]
      r_start_mm: 10.0
      r_end_mm: 70.0
      pitch_mm: 5.0
      z_mm: 10.0

  # SPIRAL – cylinder (Helix für Röhrchen)
  - id: "tubes_helix"
    description: "Helix auf Röhrchen ID5/10/20"
    tool: "spray_nozzle_01"
    substrates: ["tube_ID5mm_t1p5mm_h100mm", "tube_ID10mm_t1p5mm_h100mm", "tube_ID20mm_t1p5mm_h100mm"]
    mount: "post_d30_h100"
    side: "helix"
    parameters:
      spray_angle_deg: 10        # 5–15° empfohlen
      speed_mm_s: 180.0
    path:
      type: "spiral"
      mode: "cylinder"
      pitch_mm: 10.0
      outside_mm: 1.0
      margin_top_mm: 0.0
      margin_bottom_mm: 0.0