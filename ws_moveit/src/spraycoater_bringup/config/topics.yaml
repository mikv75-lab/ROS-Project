version: 1

topics:
  servo:
    subscribe:
      - id: cartesian_mm
        name: servo/cartesian_mm
        type: geometry_msgs/msg/TwistStamped
        qos: cmd

      - id: joint_jog
        name: servo/joint_jog
        type: control_msgs/msg/JointJog
        qos: cmd

      - id: set_mode
        name: servo/set_mode
        type: std_msgs/msg/String
        qos: cmd

      - id: set_frame
        name: servo/set_frame
        type: std_msgs/msg/String
        qos: cmd

    publish:
      - id: twist_out
        name: servo/delta_twist_cmds
        type: geometry_msgs/msg/TwistStamped
        qos: sensor_data

      - id: joint_out
        name: servo/delta_joint_cmds
        type: control_msgs/msg/JointJog
        qos: sensor_data

  tool:
    subscribe:
      - id: tool_select
        name: spraycoater/tool/select
        type: std_msgs/msg/String
        qos: default

    publish:
      - id: tool_state
        name: spraycoater/tool/state
        type: std_msgs/msg/String
        qos: latched

      - id: tool_list
        name: spraycoater/tool/list
        type: std_msgs/msg/String
        qos: latched


  moveit_py:
    subscribe:
      # ----------------------------
      # ONE request channel (STRICT, keyed, out-of-order safe)
      # ----------------------------
      - id: plan_request
        name: spraycoater/moveit_py/plan_request
        type: std_msgs/msg/String
        qos: default

      - id: stop
        name: spraycoater/moveit_py/stop
        type: std_msgs/msg/Empty
        qos: default

      - id: set_speed_mm_s
        name: spraycoater/moveit_py/set_speed_mm_s
        type: std_msgs/msg/Float64
        qos: default

      - id: set_planner_cfg
        name: spraycoater/moveit_py/set_planner_cfg
        type: std_msgs/msg/String
        qos: default

      # Trajectory in/out: request-scoped key JSON in jt.header.frame_id
      - id: execute_trajectory
        name: spraycoater/moveit_py/execute_trajectory
        type: moveit_msgs/msg/RobotTrajectory
        qos: default

      - id: optimize_trajectory
        name: spraycoater/moveit_py/optimize_trajectory
        type: moveit_msgs/msg/RobotTrajectory
        qos: default

    publish:
      - id: busy
        name: spraycoater/moveit_py/busy
        type: std_msgs/msg/Bool
        qos: default
      - id: tray_exec_ready
        name: spraycoater/moveit_py/tray_exec_ready
        type: std_msgs/msg/Bool
        qos: default
      
      # Result/status lines must carry the same key JSON (run/id/seg/op/status/...)
      - id: motion_result
        name: spraycoater/moveit_py/motion_result
        type: std_msgs/msg/String
        qos: default

      # Trajectories are "stateful last value" for UI/FK -> LATCHED
      - id: planned_trajectory_rt
        name: spraycoater/moveit_py/planned_trajectory_rt
        type: moveit_msgs/msg/RobotTrajectory
        qos: latched

      - id: executed_trajectory_rt
        name: spraycoater/moveit_py/executed_trajectory_rt
        type: moveit_msgs/msg/RobotTrajectory
        qos: latched

      - id: optimized_trajectory_rt
        name: spraycoater/moveit_py/optimized_trajectory_rt
        type: moveit_msgs/msg/RobotTrajectory
        qos: latched

      # Event -> not latched
      - id: traj_cache_clear
        name: spraycoater/moveit_py/traj_cache_clear
        type: std_msgs/msg/Empty
        qos: default

      # Robot model is static -> latched
      - id: robot_description
        name: robot_description
        type: std_msgs/msg/String
        qos: latched

      - id: robot_description_semantic
        name: robot_description_semantic
        type: std_msgs/msg/String
        qos: latched




  scene:
    publish:
      - id: cage_list
        name: spraycoater/scene/cage/list
        type: std_msgs/msg/String
        qos: latched
      - id: mount_list
        name: spraycoater/scene/mount/list
        type: std_msgs/msg/String
        qos: latched
      - id: substrate_list
        name: spraycoater/scene/substrate/list
        type: std_msgs/msg/String
        qos: latched

      - id: cage_current
        name: spraycoater/scene/cage/current
        type: std_msgs/msg/String
        qos: latched
      - id: mount_current
        name: spraycoater/scene/mount/current
        type: std_msgs/msg/String
        qos: latched
      - id: substrate_current
        name: spraycoater/scene/substrate/current
        type: std_msgs/msg/String
        qos: latched

      - id: collision_object
        name: collision_object
        type: moveit_msgs/msg/CollisionObject
        qos: scene_collision

    subscribe:
      - id: cage_set
        name: spraycoater/scene/cage/set
        type: std_msgs/msg/String
        qos: default
      - id: mount_set
        name: spraycoater/scene/mount/set
        type: std_msgs/msg/String
        qos: default
      - id: substrate_set
        name: spraycoater/scene/substrate/set
        type: std_msgs/msg/String
        qos: default

  poses:
    subscribe:
      - id: set_home
        name: spraycoater/poses/set_home
        type: std_msgs/msg/Empty
        qos: default
      - id: set_service
        name: spraycoater/poses/set_service
        type: std_msgs/msg/Empty
        qos: default

    publish:
      - id: home_pose
        name: spraycoater/poses/home
        type: geometry_msgs/msg/PoseStamped
        qos: latched
      - id: service_pose
        name: spraycoater/poses/service
        type: geometry_msgs/msg/PoseStamped
        qos: latched
        
  spray_path:
    # NOTE (SSoT-Konvention):
    # - subscribe: Topics, die DIESES Node abonniert (UI/Bridge -> Node => Bridge muss publishen)
    # - publish:   Topics, die DIESES Node publiziert (Node -> RViz)
    #
    # F체r BaseBridge.pub(...) m체ssen die UI->Node IDs zus채tzlich in der Bridge-SSoT
    # als "publish" gef체hrt werden (Bridge-Perspektive). Wenn du NUR EINE topics.yaml
    # fahren willst, musst du im Bridge-Loader beide Sektionen mappen.
    #
    # Inhaltlich (Node-Perspektive) ist das hier korrekt.

    subscribe:
      # --- Steuerung (Toggles) ---
      # Compiled bleibt global (ein Toggle).
      # Planned/Executed werden getrennt nach Stored vs Run getoggelt.
      # show_planned/show_executed bleiben als "Master" (schalten beide).
      - id: clear
        name: spraycoater/spray_path/clear
        type: std_msgs/msg/Empty
        qos: latched

      - id: show_compiled
        name: spraycoater/spray_path/show_compiled
        type: std_msgs/msg/Bool
        qos: latched

      # Master (optional / backward compatible)
      - id: show_planned
        name: spraycoater/spray_path/show_planned
        type: std_msgs/msg/Bool
        qos: latched

      - id: show_executed
        name: spraycoater/spray_path/show_executed
        type: std_msgs/msg/Bool
        qos: latched

      # Split toggles (NEU)
      - id: show_planned_run
        name: spraycoater/spray_path/show_planned_run
        type: std_msgs/msg/Bool
        qos: latched

      - id: show_planned_stored
        name: spraycoater/spray_path/show_planned_stored
        type: std_msgs/msg/Bool
        qos: latched

      - id: show_executed_run
        name: spraycoater/spray_path/show_executed_run
        type: std_msgs/msg/Bool
        qos: latched

      - id: show_executed_stored
        name: spraycoater/spray_path/show_executed_stored
        type: std_msgs/msg/Bool
        qos: latched

      # --- COMPILED (Maske) ---
      - id: compiled_poses_in
        name: spraycoater/spray_path/compiled/poses_in
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: compiled_markers_in
        name: spraycoater/spray_path/compiled/markers_in
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # --- PLANNED: NEW (Run) ---
      - id: planned_new_poses_in
        name: spraycoater/spray_path/planned/new/poses_in
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: planned_new_markers_in
        name: spraycoater/spray_path/planned/new/markers_in
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # --- PLANNED: STORED (Disk) ---
      - id: planned_stored_markers_in
        name: spraycoater/spray_path/planned/stored/markers_in
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # --- EXECUTED: NEW (Run) ---
      - id: executed_new_poses_in
        name: spraycoater/spray_path/executed/new/poses_in
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: executed_new_markers_in
        name: spraycoater/spray_path/executed/new/markers_in
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # --- EXECUTED: STORED (Disk) ---
      - id: executed_stored_markers_in
        name: spraycoater/spray_path/executed/stored/markers_in
        type: visualization_msgs/msg/MarkerArray
        qos: latched

    publish:
      # --- Visualisierung (Cache Node -> RViz) ---

      # Compiled
      - id: compiled_poses
        name: spraycoater/spray_path/compiled/poses
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: compiled_markers
        name: spraycoater/spray_path/compiled/markers
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # Planned (New)
      - id: planned_new_poses
        name: spraycoater/spray_path/planned/new/poses
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: planned_new_markers
        name: spraycoater/spray_path/planned/new/markers
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # Planned (Stored)
      - id: planned_stored_markers
        name: spraycoater/spray_path/planned/stored/markers
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # Executed (New)
      - id: executed_new_poses
        name: spraycoater/spray_path/executed/new/poses
        type: geometry_msgs/msg/PoseArray
        qos: latched

      - id: executed_new_markers
        name: spraycoater/spray_path/executed/new/markers
        type: visualization_msgs/msg/MarkerArray
        qos: latched

      # Executed (Stored)
      - id: executed_stored_markers
        name: spraycoater/spray_path/executed/stored/markers
        type: visualization_msgs/msg/MarkerArray
        qos: latched




  robot:
    subscribe:
      - id: init
        name: spraycoater/robot/init
        type: std_msgs/msg/Empty
        qos: default

      - id: stop
        name: spraycoater/robot/stop
        type: std_msgs/msg/Empty
        qos: default

      - id: clear_error
        name: spraycoater/robot/clear_error
        type: std_msgs/msg/Empty
        qos: default

      - id: power_on
        name: spraycoater/robot/power_on
        type: std_msgs/msg/Empty
        qos: default

      - id: power_off
        name: spraycoater/robot/power_off
        type: std_msgs/msg/Empty
        qos: default

      - id: servo_on
        name: spraycoater/robot/servo_enable
        type: std_msgs/msg/Empty
        qos: default

      - id: servo_off
        name: spraycoater/robot/servo_disable
        type: std_msgs/msg/Empty
        qos: default

      - id: joint_states_in
        name: joint_states
        type: sensor_msgs/msg/JointState
        qos: sensor_data

    publish:
      - id: connection
        name: spraycoater/robot/connection
        type: std_msgs/msg/Bool
        qos: latched

      - id: mode
        name: spraycoater/robot/mode
        type: std_msgs/msg/String
        qos: latched

      - id: initialized
        name: spraycoater/robot/initialized
        type: std_msgs/msg/Bool
        qos: latched

      - id: moving
        name: spraycoater/robot/moving
        type: std_msgs/msg/Bool
        qos: latched

      - id: servo_enabled
        name: spraycoater/robot/servo_enabled
        type: std_msgs/msg/Bool
        qos: latched

      - id: power
        name: spraycoater/robot/power
        type: std_msgs/msg/Bool
        qos: latched

      - id: estop
        name: spraycoater/robot/estop
        type: std_msgs/msg/Bool
        qos: latched

      - id: errors
        name: spraycoater/robot/errors
        type: std_msgs/msg/String
        qos: latched

      - id: tcp_pose
        name: spraycoater/robot/tcp_pose
        type: geometry_msgs/msg/PoseStamped
        qos: sensor_data

      - id: joints
        name: spraycoater/robot/joint_states
        type: sensor_msgs/msg/JointState
        qos: sensor_data

  omron:
    subscribe:
      - id: command_in
        name: spraycoater/omron/command
        type: std_msgs/msg/String
        qos: default

    publish:
      - id: raw_tx
        name: spraycoater/omron/raw_tx
        type: std_msgs/msg/String
        qos: default

      - id: raw_rx
        name: spraycoater/omron/raw_rx
        type: std_msgs/msg/String
        qos: default

      - id: connection_status
        name: spraycoater/omron/connection_status
        type: std_msgs/msg/Bool
        qos: default